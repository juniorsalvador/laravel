# coleta de metricas

local red = redis:new()
red:set_timeout(1000)

local ok, err = red:connect("redis-host", 6379)
if not ok then
    ngx.log(ngx.ERR, "failed to connect to Redis: ", err)
    return ngx.exit(500)
end

-- Coletar todas as chaves e seus valores
local keys = red:keys("*")
local metrics = {}

for i, key in ipairs(keys) do
    local value = red:get(key)
    table.insert(metrics, {
        key = key,
        requests = tonumber(value) or 0,
        ttl = red:ttl(key)
    })
end

red:close()

ngx.header.content_type = "application/json"
ngx.say(cjson.encode(metrics))

# Integração com Sistema de Monitoramento

-- Adicionar ao final do rate_limit.lua
local http = require "resty.http"
local hc = http:new()

-- Enviar métricas para Datadog
local metric_data = {
    series = {
        {
            metric = "nginx.rate_limit.requests",
            points = { { os.time(), current } },
            tags = { "key:" .. key, "host:" .. ngx.var.host },
            type = "gauge"
        }
    }
}

local ok, err = hc:request_uri("https://api.datadoghq.com/api/v1/series", {
    method = "POST",
    body = cjson.encode(metric_data),
    headers = {
        ["Content-Type"] = "application/json",
        ["DD-API-KEY"] = "your-datadog-api-key"
    }
})

if not ok then
    ngx.log(ngx.ERR, "failed to send metrics to Datadog: ", err)
end

# Implementação Alternativa com Shared Dictionary

local limit = 100
local window = 60
local key = ngx.var.remote_addr

local counters = ngx.shared.rate_limit_counters
local current = counters:get(key)

if current then
    if current >= limit then
        ngx.exit(429)
    else
        counters:incr(key, 1)
    end
else
    counters:set(key, 1, window)
end
